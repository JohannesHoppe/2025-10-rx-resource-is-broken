import{a as C}from"./chunk-4DVWLT4T.js";import{a as y,b as v,c as R,d as b,e as B}from"./chunk-R7U4NZFW.js";import{A as p,C as g,E as e,H as S,T as k,i as x,j as E,l as d,m as _,o as s,p as c,s as m,t as o,u as t,v as l}from"./chunk-ZW3TMCPU.js";function T(i,r){i&1&&(l(0,"span",17),o(1,"span",18),e(2,"Loading..."),t())}function D(i,r){if(i&1&&l(0,"app-book-card",14),i&2){let a=g().buggyResource.value();m("book",a)}}function M(i,r){i&1&&l(0,"app-error-display",15),i&2&&m("error",r)}function w(i,r){i&1&&(l(0,"span",17),o(1,"span",18),e(2,"Loading..."),t())}function I(i,r){i&1&&l(0,"app-error-display",15),i&2&&m("error",r)}function L(i,r){if(i&1&&l(0,"app-book-card",14),i&2){let a=g().fixedResource.value();m("book",a)}}var h=class i{bookService=x(b);selectedIsbn=E("9783864909467");buggyResource=y({params:()=>this.selectedIsbn(),stream:({params:r})=>this.bookService.getBook(r)});fixedResource=B({params:()=>this.selectedIsbn(),stream:({params:r})=>this.bookService.getBook(r)});constructor(){this.bookService.toggleErrorMode(),this.bookService.toggleSlowMode()}reload(){this.buggyResource.reload(),this.fixedResource.reload()}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=_({type:i,selectors:[["app-bug3-reload"]],features:[S([b])],decls:66,vars:7,consts:[[1,"demo-container"],[1,"demo-header"],["routerLink","/","aria-label","Back to home",1,"back-link"],[1,"subtitle"],[1,"github"],[1,"controls"],[1,"hint"],[1,"control-buttons"],["type","button",1,"btn-primary","text-nowrap",3,"click"],[3,"slowModeToggle","errorModeToggle","isSlowModeEnabled","isErrorModeEnabled"],[1,"comparison"],[1,"demo-card","buggy"],[1,"card-header"],[1,"card-body"],[3,"book"],[3,"error"],[1,"demo-card","fixed"],[1,"spinner-tiny"],[1,"loading-text"]],template:function(a,n){if(a&1&&(o(0,"div",0)(1,"header",1)(2,"a",2),e(3,"\u2190 Back to Home"),t(),o(4,"h1"),e(5,"Bug #3: reload() Doesn't Clear Error State Immediately"),t(),o(6,"p",3),e(7," When a resource is in error state and you call "),o(8,"code"),e(9,"reload()"),t(),e(10,', the error should clear immediately. This gives users visual feedback that their reload action was received and the system is now attempting to recover. Instead, the error persists until the new request completes. Users click "Reload" but still see alarming red error messages during the reload attempt. This creates a confusing user experience. '),t(),o(11,"p",4)(12,"strong"),e(13,"Affects:"),t(),o(14,"code"),e(15,"resource()"),t(),e(16,", "),o(17,"code"),e(18,"rxResource()"),t(),e(19,", and "),o(20,"code"),e(21,"httpResource()"),t(),e(22," (all share the same "),o(23,"code"),e(24,"reload()"),t(),e(25," behavior)"),l(26,"br"),o(27,"strong"),e(28,"The Problem:"),t(),o(29,"code"),e(30,"reload()"),t(),e(31," keeps the old error visible while fetching new data, only clearing it after the new response arrives. This creates a confusing state where "),o(32,"code"),e(33,"isLoading: true"),t(),e(34," and "),o(35,"code"),e(36,"hasError: true"),t(),e(37," both return true simultaneously. "),t()(),o(38,"section",5)(39,"p",6),e(40,' This demo starts in error and slow mode to show the bug. Press "Reload" to retry the request. You can disable "Error Mode" to see successful loading behavior. '),t(),o(41,"div",7)(42,"button",8),p("click",function(){return n.reload()}),e(43," \u{1F504} Reload "),t(),o(44,"app-control-buttons",9),p("slowModeToggle",function(){return n.bookService.toggleSlowMode()})("errorModeToggle",function(){return n.bookService.toggleErrorMode()}),t()()(),o(45,"section",10)(46,"article",11)(47,"header",12)(48,"h3"),e(49," \u{1F534} BUGGY: rxResource.reload() "),s(50,T,3,0),t(),o(51,"p"),e(52,"Error state persists during reload"),t()(),o(53,"div",13),s(54,D,1,1,"app-book-card",14),s(55,M,1,1,"app-error-display",15),t()(),o(56,"article",16)(57,"header",12)(58,"h3"),e(59," \u{1F7E2} FIXED: rxResourceFixed.reload() "),s(60,w,3,0),t(),o(61,"p"),e(62,"Error state clears immediately on reload"),t()(),o(63,"div",13),s(64,I,1,1,"app-error-display",15)(65,L,1,1,"app-book-card",14),t()()()()),a&2){let u,f;d(44),m("isSlowModeEnabled",n.bookService.isSlowModeEnabled())("isErrorModeEnabled",n.bookService.isErrorModeEnabled()),d(6),c(n.buggyResource.isLoading()?50:-1),d(4),c(n.buggyResource.hasValue()?54:-1),d(),c((u=n.buggyResource.error())?55:-1,u),d(5),c(n.fixedResource.isLoading()?60:-1),d(4),c((f=n.fixedResource.error())?64:n.fixedResource.hasValue()?65:-1,f)}},dependencies:[k,v,R,C],encapsulation:2,changeDetection:0})};export{h as default};
